# Managing Sensitive Data in the Cloud with Google Secrets Manager.
---

Cloud platforms are known for making programming, codebase maintenance, and application system design easier, by abstracting away complexity.

https://cloud.google.com/functions/docs/configuring/secrets

### Key Vault Solutions

This structure of outsourcing management of sensitive values if often referred to as a **key vault**. Key vaults are services that allow developers to store and manage secrets, such as API keys, securely. The keys can be accessed by authenticated users or services using APIs or SDKs.

We'll use Google Cloud Platform's key vault solution to manage our sensitive API keys for the SendGrid API. It's aptly called **Google Secret Manager**.

## Create a new secret in Secret Manager

Navigate to the Google Secret Manager Tool at `https://console.cloud.google.com/security/secret-manager` or by browsing the list of all products and selecting Secret Manager.

On this page, click the blue _**Enable**_ button to enable the Secret Manager tool in your Google Cloud Platform project:

![enable-secret-manager](../assets/images/enable_secret_manager.png)

After enabling the project, you'll see a page like this. Select **_Create Secret_**.

![enable-secret-manager](../assets/images/create_secret.png)

This will load a form to create a new secret:

![new-secret-form](../assets/images/new-secret-form.png)

Give your new secret any name of your choosing (just remember what you name it!). Then, copy/paste your SendGrid API key directly into the _Secret value_ form field. You are not required to upload a file.

| ‚ö†Ô∏è  Important Note |
|--------------------|
| Be **very careful** to ensure your API Key is copied over _exactly_ how it appears in SendGrid. A small missing character will cause authorization failures down the line. Even an extra whitespace--nearly invisible to the human eye--can cause difficult-to-diagnose issues. _Ask me how I know._ |

Once you're certain the secret value contains your precise API Key, click _**Create Secret**_.

You'll be taken to a page where you can later manager your secret; including viewing, enabling, disabling, and destroying:

![secrets detail page in GCP](../assets/images/secret_details_page.png)

Next, return to your Cloud Function. Select the **_Edit_**:

![edit-option-in-gcp](../assets/images/edit_option_in_gcp_cloud.png)

On the first edit page, locate and expand the section titled _**Runtime, build, connections and security settings**_

![security-settings](../assets/images/security_options_in_gcp_cloud_functions.png)

In this panel, select the _**Security and Image Repo Options**_ tab. You should see a link reading **_Reference a Secret_**. Click this link:

![reference-a-secret](../assets/images/security_and_image_repo_options.png)

This will open a form. From the _**Secret**_ dropdown, select the secret you just created.

A message below the dropdown will appear, stating your project doesn't currently have permission to access this secret. Click _**Grant**_

![reference-a-secret](../assets/images/reference_a_secret_in_cloud_function.png)

Complete the form by selecting _**Expose as environmental variable**_. This will reveal further variable options. Give your environmental variable a name. **This will be the variable name you call directly in your code.**

![naming env variables](../assets/images/naming_env_variables.png)

Click _**Done**_. You will be provided the option to review your configurations. Click **_Next_**.

This will take you back to the inline code editor. From here, we can access our new environmental variable at the top of our file:

```JavaScript
const https = require('https');
const SENDGRID_API_KEY = process.env.SENDGRID_API_KEY;

[...]
```

---

| [‚¨ÖÔ∏è  Back ‚Äî]() | [‚Äî üè† Home ‚Äî](https://github.com/courtneyphillips/project-canis-educere) | [‚Äî Next  ‚û°Ô∏è]() |
| --- | --- | --- |
